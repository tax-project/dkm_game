<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dkm.mallEvents.dao.CancerDao">


    <resultMap id="selectItem" type="com.dkm.mallEvents.entities.vo.SingleTopUpVo">
        <id column="id" property="id"/>
        <result column="day" property="day"/>
        <collection property="goods" ofType="com.dkm.mallEvents.entities.vo.GoodsInfoVo" column="item_id">
            <id column="item_id" property="id"/>
            <result column="name" property="name"/>
            <result column="goods_id" property="goodsId"/>
            <result column="size" property="size"/>
            <result column="image_url" property="imageUrl"/>
        </collection>
    </resultMap>
    <insert id="addUser">
        INSERT INTO tb_mall_single_user (user_id, tb_mall_single_id)
        VALUES (#{param1}, #{param2})
    </insert>

    <select id="selectSingle" resultMap="selectItem">
        SELECT a.id      id,
               b.id   as item_id,
               c.id   as goods_id,
               a.day  as day,
               b.size as size,
               c.name as name,
               c.url  as image_url
        FROM tb_mall_single a,
             tb_mall_single_item b,
             tb_goods c
        WHERE a.id = b.tb_mall_single_id
          AND c.id = b.goods_id
    </select>
    <select id="findCheckedById" resultType="com.dkm.mallEvents.entities.vo.SingleUserVo">
        SELECT *
        FROM tb_mall_single_user
        WHERE tb_mall_single_id = #{id}
          AND user_id = #{userId}
    </select>
    <select id="selectById" resultType="com.dkm.mallEvents.entities.vo.GoodsInfoVo">
        SELECT a.id id, b.id goods_id, b.name name, b.url image_url, a.size size
        From tb_mall_single_item a
                 join tb_goods b on a.goods_id = b.id
        where tb_mall_single_id = #{id}
    </select>
    <select id="selectHistoryByUser" resultType="com.dkm.mallEvents.entities.vo.SingleHistoryUserVo">
        SELECT user_id, tb_mall_single_id item_id
        FROM tb_mall_single_user
        WHERE user_id = #{param1}
          AND tb_mall_single_id = #{param2}
    </select>
</mapper>