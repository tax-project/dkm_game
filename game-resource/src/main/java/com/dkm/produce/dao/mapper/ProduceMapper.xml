<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.dkm.produce.dao.ProduceMapper">

    <select id="queryJoinOutPutGoods" resultType="com.dkm.produce.entity.vo.AttendantGoods" parameterType="java.lang.Long">
        select a.id,a.good_id,a.number,d.name,d.url, c.at_img,
               COUNT(d.name) as sum from tb_produce a,tb_user_produce b,tb_attendant c,tb_goods d
        where b.produce_id=a.id and a.attendant_id=c.id and a.good_id=d.id and b.user_id=#{userId} GROUP BY a.id
    </select>


    <select id="queryOutput" resultType="com.dkm.produce.entity.vo.AttendantVo" parameterType="java.lang.Long">
        select max(b.attendant_id) as 'attendantId',sum(b.number) as 'number',max(c.id) as 'goodId'
              ,max(c.name) as 'goodName',max(c.url) as 'imgUrl'
              from tb_user_produce a join tb_produce b
              on a.produce_id = b.id join tb_goods c on b.good_id = c.id
              where a.user_id= #{userId}
              group by b.attendant_id
    </select>


    <!--<select id="queryOutput1" resultType="com.dkm.produce.entity.vo.AttendantVo" parameterType="java.lang.Long">-->
        <!--select b.attendant_id as 'attendantId',b.number,c.id as 'goodId'-->
                <!--,c.name as 'goodName',c.url as 'imgUrl'from tb_user_produce a join tb_produce b-->
                <!--on a.produce_id = b.id join tb_goods c on b.good_id = c.id-->
        <!--where a.user_id= #{userId} and b.attendant_id = #{id}-->
    <!--</select>-->


    <select id="queryProduce" parameterType="java.lang.Long" resultType="com.dkm.produce.entity.vo.UserAttendantGoods">
        select a.number,c.name,c.url,d.at_name,d.at_img,a.id from tb_produce a,tb_user_produce au,tb_goods c,tb_attendant d where
            a.id=au.produce_id and a.good_id=c.id and a.attendant_id=d.id and a.good_id=#{userId} and au.user_id=#{goodId}
    </select>

    <update id="updateNumber" parameterType="java.lang.Long">
        update  tb_produce set number=number+#{number} where id=#{Id}
    </update>


</mapper>
