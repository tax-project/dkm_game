<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.dkm.produce.dao.ProduceMapper">

    <select id="queryJoinOutPutGoods" resultType="com.dkm.produce.entity.vo.AttendantGoods" parameterType="java.lang.Long">
        select a.id,a.good_id,a.number,d.name,d.url, c.at_img,
               COUNT(d.name) as sum from tb_produce a,tb_user_produce b,tb_attendant c,tb_goods d
        where b.produce_id=a.id and a.attendant_id=c.id and a.good_id=d.id and b.user_id=#{userId} GROUP BY a.id
    </select>


    <select id="queryOutput" resultType="com.dkm.produce.entity.vo.AttendantPutVo" parameterType="java.lang.Long">
        select max(b.attendant_id) as 'attendantId',sum(b.number) as 'number',max(c.id) as 'goodId'
              ,max(c.name) as 'goodName',max(c.url) as 'imgUrl',d.caught_people_id
              from tb_user_produce a join tb_produce b
              on a.produce_id = b.id join tb_goods c on b.good_id = c.id
              join tb_attendant_user d on b.attendant_id = d.attendant_id
              where a.user_id= #{userId}
              group by b.attendant_id,d.caught_people_id,c.id
    </select>


    <select id="queryAllIdList" resultType="com.dkm.produce.entity.vo.ProduceSelectVo">
        select a.id as 'produceId',b.id as 'produceUserId'
        from tb_produce a join tb_user_produce b on a.id = b.produce_id
        where a.attendant_id = #{aId} and b.user_id = #{userId}
    </select>

    <delete id="deleteProduce" parameterType="com.dkm.produce.entity.vo.ProduceSelectVo">
        delete from tb_produce where
        <foreach collection="list" item="item" index="index" separator="or">
            id = #{item.produceId}
        </foreach>
    </delete>


    <delete id="deleteProduceUser" parameterType="com.dkm.produce.entity.vo.ProduceSelectVo">
        delete from tb_user_produce where
        <foreach collection="list" item="item" index="index" separator="or">
            id = #{item.produceUserId}
        </foreach>
    </delete>

</mapper>
